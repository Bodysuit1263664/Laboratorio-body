#!/bin/bash
# Coded on Agust 2019 by Ivam3
# This file bring a easy access to execute i-Haklab tools
#
SCRIPT_NAME=$(basename "$0")
BEEF_PATH="/data/data/com.termux/files/usr/opt/beef"
BACK=$(pwd)
RUBYv=$(ls $PREFIX/lib/ruby |grep '[0-9].[0-9].[0-9]')
#
command -v wget > /dev/null || apt install wget -y > /dev/null 2>&1
curl -Ls https://raw.githubusercontent.com/ivam3/i-Haklab/master/.set/libexec/colors -o $PREFIX/libexec/colors
if [ -e $PREFIX/libexec/colors ];then
	chmod +x $PREFIX/libexec/colors;source $PREFIX/libexec/colors
fi
STDERR() {
        echo "[w]-> BeeF is not installed." 
        exit
}

#
# Fix ruby bigdecimal extensions linking error.
case "$(uname -m)" in
        aarch64)
                export LD_PRELOAD="$LD_PRELOAD:/data/data/com.termux/files/usr/lib/ruby/$RUBYv/aarch64-linux-android/bigdecimal.so"
                ;;
        arm*)
                export LD_PRELOAD="$LD_PRELOAD:/data/data/com.termux/files/usr/lib/ruby/$RUBYv/arm-linux-androideabi/bigdecimal.so"
                ;;
        i686)
                export LD_PRELOAD="$LD_PRELOAD:/data/data/com.termux/files/usr/lib/ruby/$RUBYv/i686-linux-android/bigdecimal.so"
                ;;
        x86_64)
                export LD_PRELOAD="$LD_PRELOAD:/data/data/com.termux/files/usr/lib/ruby/$RUBYv/x86_64-linux-android/bigdecimal.so"
                ;;
        *)
                ;;
esac

case "$SCRIPT_NAME" in
        beef|beef-xss)
		if [ -d $BEEF_PATH ]; then
                        cd $BEEF_PATH > /dev/null
                        echo "load msgrpc ServerHost=127.0.0.1 ServerPort=55552 User=msf Pass='abc123'" > $PREFIX/opt/metasploit-framework/BeeF.rc
                        printf "$Y[!]-> In a new session run :$W\n"
                        printf "      postgresql start\n"
                        printf "      msfconsole -r $PREFIX/opt/metasploit-framework/BeeF.rc\n\n"
                        printf "$G[!]->$W then press$G enter$W to continue\n"
                        read enter
                        exec ruby $BEEF_PATH/$SCRIPT_NAME
                else
                        STDERR
                fi
                ;;
	*)
		;;
esac

#		@Ivam3
